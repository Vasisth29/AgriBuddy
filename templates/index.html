<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriBuddy - Smart Farming Made Simple</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- Chart.js for Yield Chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <!-- Fallback to local Chart.js -->
    <script>window.Chart || document.write('<script src="{{ url_for('static', filename='chart.min.js') }}"><\/script>');</script>
    <style>
        :root {
            --primary-green: #2E7D32;
            --dark-green: #1B5E20;
            --secondary-light-green: #E8F5E9;
            --accent-gold: #FFD700;
            --text-dark: #1B5E20;
            --background-texture: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAGklEQVQImWNgYGBgYHB3d3d39z8ABAAA//8DAAp8AWE0AAAAAElFTkSuQmCC');
        }
        html { height: 100%; scroll-behavior: smooth; }
        body {
            background-color: var(--secondary-light-green);
            background-image: linear-gradient(135deg, rgba(46, 125, 50, 0.08), rgba(255, 215, 0, 0.12)), var(--background-texture);
            font-family: 'Poppins', sans-serif;
            color: var(--text-dark);
            display: flex;
            flex-direction: column;
            min-height: 100%;
            margin: 0;
        }
        .navbar { background-color: var(--primary-green); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .navbar-brand { color: var(--secondary-light-green) !important; font-weight: bold; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
        .navbar-brand img { height: 120px; width: auto; }
        .nav-link { color: var(--secondary-light-green) !important; border-bottom: 3px solid transparent; }
        .nav-link.active { background-color: var(--dark-green) !important; border-bottom: 3px solid var(--accent-gold); }
        .hero {
            background: url('{{ url_for('static', filename='hero.jpg') }}') no-repeat center center/cover;
            background-attachment: fixed;
            height: 65vh;
            width: 100vw;
            position: relative;
            left: 50%;
            right: 50%;
            margin-left: -50vw;
            margin-right: -50vw;
            overflow: hidden;
        }
        .hero::after {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(120deg, rgba(27, 94, 32, 0.85), rgba(46, 125, 50, 0.4));
            mix-blend-mode: multiply;
        }
        .hero h1 { font-size: 3.2rem; color: #ffffff; text-shadow: 0 15px 30px rgba(0,0,0,0.45); }
        .hero p { font-size: 1.3rem; color: #e8f5e9; max-width: 640px; }
        .hero-content {
            position: relative;
            z-index: 2;
            padding: 2rem;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(6px);
            box-shadow: 0 40px 80px rgba(0, 0, 0, 0.25);
        }
        .scroll-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: #ffffff;
            text-align: center;
            font-size: 0.95rem;
            letter-spacing: 2px;
            cursor: pointer;
            z-index: 3;
        }
        .scroll-indicator span {
            display: block;
            font-size: 2rem;
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(6px); }
            60% { transform: translateY(3px); }
        }
        .service-icon { font-size: 2.5rem; color: var(--primary-green); }
        .loading { text-align: center; padding: 2rem; font-size: 1.2rem; color: var(--primary-green); display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: rgba(255, 255, 255, 0.9); z-index: 1000; border-radius: 10px; padding: 20px; }
        .spinner { border: 4px solid rgba(0, 0, 0, 0.1); border-left-color: var(--primary-green); height: 30px; width: 30px; border-radius: 50%; animation: spin 1s linear infinite; display: inline-block; margin-right: 10px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .recommendation-img { width: 100%; height: 180px; object-fit: cover; border-radius: 15px 15px 0 0; }
        .crop-item { cursor: pointer; margin: 5px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; background-color: #fff; position: relative; overflow: hidden; }
        .crop-item:hover { background-color: #e0e0e0; }
        .crop-details { display: none; margin-left: 20px; padding: 10px; background-color: #f9f9f9; border-left: 4px solid var(--primary-green); }
        .no-image { text-align: center; color: #666; padding: 20px; }
        .footer { background-color: var(--primary-green); color: var(--secondary-light-green); padding: 1rem 0; flex-shrink: 0; margin-top: auto; }
        #terms { text-align: center; padding: 5rem; background-color: #ffffff; border-radius: 10px; margin: 5rem auto; max-width: 600px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); flex: 1; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        #terms img { height: 200px; width: auto; margin-bottom: 20px; }
        #content { display: none; flex-direction: column; flex: 1 0 auto; }
        .tab-pane { padding: 2rem; min-height: 80vh; }
        #india-map { width: 100%; height: 450px; margin: 0 auto 2rem; display: block; }
        .uploaded-image { max-width: 300px; margin-top: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .health-indicator { max-height: 200px; margin-top: 10px; }
        .camera-preview { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: rgba(0,0,0,0.8); padding: 20px; z-index: 1001; border-radius: 10px; }
        .camera-preview video { width: 100%; max-width: 400px; }
        @media (max-width: 768px) {
            .hero { background-attachment: scroll; height: 70vh; }
            .hero h1 { font-size: 2.4rem; }
            .hero-content { margin: 0 1rem; padding: 1.5rem; }
        }
        @media (max-width: 576px) {
            .uploaded-image { max-width: 100%; }
            .health-indicator { max-width: 100%; }
            .card { width: 280px; }
            .content { padding: 24px; }
            .hero h1 { font-size: 2rem; }
            .hero p { font-size: 1.2rem; }
            #india-map { height: 300px; }
            .loader { width: 150px; height: 150px; } /* Scale down for mobile */
            .navbar-brand img { height: 80px; }
            #terms img { height: 160px; }
        }
        .card {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 320px;
            border-radius: 24px;
            line-height: 1.6;
            transition: all 0.48s cubic-bezier(0.23, 1, 0.32, 1);
            margin: 20px auto;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(46, 125, 50, 0.3);
        }
        .content {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 24px;
            padding: 36px;
            border-radius: 22px;
            color: #ffffff;
            background: var(--primary-green);
            transition: all 0.48s cubic-bezier(0.23, 1, 0.32, 1);
            width: 100%;
        }
        .content::before {
            position: absolute;
            content: "";
            top: -4%;
            left: 50%;
            width: 90%;
            height: 90%;
            transform: translate(-50%);
            background: #A5D6A7;
            z-index: -1;
            transform-origin: bottom;
            border-radius: inherit;
            transition: all 0.48s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .content::after {
            position: absolute;
            content: "";
            top: -8%;
            left: 50%;
            width: 80%;
            height: 80%;
            transform: translate(-50%);
            background: var(--secondary-light-green);
            z-index: -2;
            transform-origin: bottom;
            border-radius: inherit;
            transition: all 0.48s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .content i {
            font-size: 48px;
            color: #FFFFFF;
        }
        .content .para {
            z-index: 1;
            opacity: 1;
            font-size: 18px;
            transition: all 0.48s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .content .link {
            z-index: 1;
            color: #fea000;
            text-decoration: none;
            font-family: inherit;
            font-size: 16px;
            transition: all 0.48s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .content .link:hover {
            text-decoration: underline;
        }
        .card:hover {
            transform: translate(0px, -16px);
        }
        .card:hover .content::before {
            rotate: -8deg;
            top: 0;
            width: 100%;
            height: 100%;
        }
        .card:hover .content::after {
            rotate: 8deg;
            top: 0;
            width: 100%;
            height: 100%;
        }
        #bottone1 {
            padding-left: 33px;
            padding-right: 33px;
            padding-bottom: 16px;
            padding-top: 16px;
            border-radius: 9px;
            background: #d5f365;
            border: none;
            font-family: inherit;
            text-align: center;
            cursor: pointer;
            transition: 0.4s;
            color: var(--text-dark);
        }
        #bottone1:hover {
            box-shadow: 7px 5px 56px -14px #C3D900;
        }
        #bottone1:active {
            transform: scale(0.97);
            box-shadow: 7px 5px 56px -10px #C3D900;
        }
        .get-started-btn {
            padding: 15px 30px;
            font-size: 18px;
            outline: none;
            border: none;
            border-radius: 10px;
            transition: 0.5s;
            background: #1e1e1e;
            cursor: pointer;
            color: greenyellow;
            box-shadow: 0 0 10px #363636, inset 0 0 10px #363636;
            text-decoration: none;
            display: inline-block;
        }
        .get-started-btn:hover {
            animation: a 0.5s 1 linear;
        }
        @keyframes a {
            0% { transform: scale(0.7, 1.3); }
            25% { transform: scale(1.3, 0.7); }
            50% { transform: scale(0.7, 1.3); }
            75% { transform: scale(1.3, 0.7); }
            100% { transform: scale(1, 1); }
        }
        #features {
            background: #ffffff;
            border-radius: 24px;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.12);
            padding: 2.5rem;
            position: relative;
            overflow: hidden;
        }
        #features::after {
            content: "";
            position: absolute;
            inset: 20px;
            border: 1px solid rgba(46, 125, 50, 0.12);
            border-radius: 18px;
            pointer-events: none;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 28px;
            padding: 2.5rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 35px 120px rgba(46, 125, 50, 0.12);
        }
        .gradient-section {
            position: relative;
            background: linear-gradient(135deg, rgba(232, 245, 233, 0.9), rgba(255, 255, 255, 0.95));
            border-radius: 32px;
            padding: 3rem 2rem;
            overflow: hidden;
        }
        .gradient-section > * {
            position: relative;
            z-index: 1;
        }
        .gradient-section::before {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top right, rgba(255, 215, 0, 0.35), transparent 45%);
            transform: translateY(-20%);
            animation: floatGlow 6s ease-in-out infinite alternate;
            pointer-events: none;
        }
        @keyframes floatGlow {
            from { transform: translateY(-10%); opacity: 0.5; }
            to { transform: translateY(10%); opacity: 0.9; }
        }
        .section-divider {
            width: 90px;
            height: 3px;
            background: var(--accent-gold);
            margin: 1.5rem auto 2rem;
            border-radius: 999px;
        }
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(60px) scale(0.98);
            transition: opacity 0.7s ease, transform 0.7s ease;
        }
        .animate-on-scroll.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        #about-content h1, #about-content h2, #about-content h3, #about-content h4 {
            color: var(--primary-green);
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }
        #about-content p {
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        #about-content ul {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }
        #about-content li {
            margin-bottom: 0.5rem;
        }
        .neon-checkbox {
            --primary: #00ffaa;
            --primary-dark: #00cc88;
            --primary-light: #88ffdd;
            --size: 30px;
            position: relative;
            width: var(--size);
            height: var(--size);
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }
        .neon-checkbox input {
            display: none;
        }
        .neon-checkbox__frame {
            position: relative;
            width: 100%;
            height: 100%;
        }
        .neon-checkbox__box {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 4px;
            border: 2px solid var(--primary-dark);
            transition: all 0.4s ease;
        }
        .neon-checkbox__check-container {
            position: absolute;
            inset: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .neon-checkbox__check {
            width: 80%;
            height: 80%;
            fill: none;
            stroke: var(--primary);
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
            stroke-dasharray: 40;
            stroke-dashoffset: 40;
            transform-origin: center;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .neon-checkbox__glow {
            position: absolute;
            inset: -2px;
            border-radius: 6px;
            background: var(--primary);
            opacity: 0;
            filter: blur(8px);
            transform: scale(1.2);
            transition: all 0.4s ease;
        }
        .neon-checkbox__borders {
            position: absolute;
            inset: 0;
            border-radius: 4px;
            overflow: hidden;
        }
        .neon-checkbox__borders span {
            position: absolute;
            width: 40px;
            height: 1px;
            background: var(--primary);
            opacity: 0;
            transition: opacity 0.4s ease;
        }
        .neon-checkbox__borders span:nth-child(1) {
            top: 0;
            left: -100%;
            animation: borderFlow1 2s linear infinite;
        }
        .neon-checkbox__borders span:nth-child(2) {
            top: -100%;
            right: 0;
            width: 1px;
            height: 40px;
            animation: borderFlow2 2s linear infinite;
        }
        .neon-checkbox__borders span:nth-child(3) {
            bottom: 0;
            right: -100%;
            animation: borderFlow3 2s linear infinite;
        }
        .neon-checkbox__borders span:nth-child(4) {
            bottom: -100%;
            left: 0;
            width: 1px;
            height: 40px;
            animation: borderFlow4 2s linear infinite;
        }
        .neon-checkbox__particles span {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
            opacity: 0;
            pointer-events: none;
            top: 50%;
            left: 50%;
            box-shadow: 0 0 6px var(--primary);
        }
        .neon-checkbox__rings {
            position: absolute;
            inset: -20px;
            pointer-events: none;
        }
        .neon-checkbox__rings .ring {
            position: absolute;
            inset: 0;
            border-radius: 50%;
            border: 1px solid var(--primary);
            opacity: 0;
            transform: scale(0);
        }
        .neon-checkbox__sparks span {
            position: absolute;
            width: 20px;
            height: 1px;
            background: linear-gradient(90deg, var(--primary), transparent);
            opacity: 0;
        }
        .neon-checkbox:hover .neon-checkbox__box {
            border-color: var(--primary);
            transform: scale(1.05);
        }
        .neon-checkbox input:checked ~ .neon-checkbox__frame .neon-checkbox__box {
            border-color: var(--primary);
            background: rgba(0, 255, 170, 0.1);
        }
        .neon-checkbox input:checked ~ .neon-checkbox__frame .neon-checkbox__check {
            stroke-dashoffset: 0;
            transform: scale(1.1);
        }
        .neon-checkbox input:checked ~ .neon-checkbox__frame .neon-checkbox__glow {
            opacity: 0.2;
        }
        .neon-checkbox input:checked ~ .neon-checkbox__frame .neon-checkbox__borders span {
            opacity: 1;
        }
        .neon-checkbox input:checked ~ .neon-checkbox__frame .neon-checkbox__particles span {
            animation: particleExplosion 0.6s ease-out forwards;
        }
        .neon-checkbox input:checked ~ .neon-checkbox__frame .neon-checkbox__rings .ring {
            animation: ringPulse 0.6s ease-out forwards;
        }
        .neon-checkbox input:checked ~ .neon-checkbox__frame .neon-checkbox__sparks span {
            animation: sparkFlash 0.6s ease-out forwards;
        }
        @keyframes borderFlow1 {
            0% { transform: translateX(0); }
            100% { transform: translateX(200%); }
        }
        @keyframes borderFlow2 {
            0% { transform: translateY(0); }
            100% { transform: translateY(200%); }
        }
        @keyframes borderFlow3 {
            0% { transform: translateX(0); }
            100% { transform: translateX(-200%); }
        }
        @keyframes borderFlow4 {
            0% { transform: translateY(0); }
            100% { transform: translateY(-200%); }
        }
        @keyframes particleExplosion {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
            20% { opacity: 1; }
            100% { transform: translate(calc(-50% + var(--x, 20px)), calc(-50% + var(--y, 20px))) scale(0); opacity: 0; }
        }
        @keyframes ringPulse {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        @keyframes sparkFlash {
            0% { transform: rotate(var(--r, 0deg)) translateX(0) scale(1); opacity: 1; }
            100% { transform: rotate(var(--r, 0deg)) translateX(30px) scale(0); opacity: 0; }
        }
        .neon-checkbox__particles span:nth-child(1) { --x: 25px; --y: -25px; }
        .neon-checkbox__particles span:nth-child(2) { --x: -25px; --y: -25px; }
        .neon-checkbox__particles span:nth-child(3) { --x: 25px; --y: 25px; }
        .neon-checkbox__particles span:nth-child(4) { --x: -25px; --y: 25px; }
        .neon-checkbox__particles span:nth-child(5) { --x: 35px; --y: 0px; }
        .neon-checkbox__particles span:nth-child(6) { --x: -35px; --y: 0px; }
        .neon-checkbox__particles span:nth-child(7) { --x: 0px; --y: 35px; }
        .neon-checkbox__particles span:nth-child(8) { --x: 0px; --y: -35px; }
        .neon-checkbox__particles span:nth-child(9) { --x: 20px; --y: -30px; }
        .neon-checkbox__particles span:nth-child(10) { --x: -20px; --y: 30px; }
        .neon-checkbox__particles span:nth-child(11) { --x: 30px; --y: 20px; }
        .neon-checkbox__particles span:nth-child(12) { --x: -30px; --y: -20px; }
        .neon-checkbox__sparks span:nth-child(1) { --r: 0deg; top: 50%; left: 50%; }
        .neon-checkbox__sparks span:nth-child(2) { --r: 90deg; top: 50%; left: 50%; }
        .neon-checkbox__sparks span:nth-child(3) { --r: 180deg; top: 50%; left: 50%; }
        .neon-checkbox__sparks span:nth-child(4) { --r: 270deg; top: 50%; left: 50%; }
        .neon-checkbox__rings .ring:nth-child(1) { animation-delay: 0s; }
        .neon-checkbox__rings .ring:nth-child(2) { animation-delay: 0.1s; }
        .neon-checkbox__rings .ring:nth-child(3) { animation-delay: 0.2s; }
        .animated-button {
            position: relative;
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 16px 36px;
            border: 4px solid;
            border-color: transparent;
            font-size: 16px;
            background-color: inherit;
            border-radius: 100px;
            font-weight: 600;
            color: greenyellow;
            box-shadow: 0 0 0 2px greenyellow;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .animated-button svg {
            position: absolute;
            width: 24px;
            fill: greenyellow;
            z-index: 9;
            transition: all 0.8s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .animated-button .arr-1 { right: 16px; }
        .animated-button .arr-2 { left: -25%; }
        .animated-button .circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background-color: greenyellow;
            border-radius: 50%;
            opacity: 0;
            transition: all 0.8s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .animated-button .text {
            position: relative;
            z-index: 1;
            transform: translateX(-12px);
            transition: all 0.8s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .animated-button:hover {
            box-shadow: 0 0 0 12px transparent;
            color: #212121;
            border-radius: 12px;
        }
        .animated-button:hover .arr-1 { right: -25%; }
        .animated-button:hover .arr-2 { left: 16px; }
        .animated-button:hover .text { transform: translateX(12px); }
        .animated-button:hover svg { fill: #212121; }
        .animated-button:active {
            scale: 0.95;
            box-shadow: 0 0 0 4px greenyellow;
        }
        .animated-button:hover .circle {
            width: 220px;
            height: 220px;
            opacity: 1;
        }
        .rainfall-stats { display: none; margin-top: 20px; padding: 15px; background: #ffffff; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .rainfall-anomaly { background-color: #fff3e0; border-left: 4px solid #ff9800; padding: 10px; margin-top: 10px; border-radius: 5px; }
        .irrigation-needed { background-color: #e8f5e9; border-left: 4px solid #4caf50; padding: 10px; margin-top: 10px; border-radius: 5px; }
        .irrigation-not-needed { background-color: #eceff1; border-left: 4px solid #9e9e9e; padding: 10px; margin-top: 10px; border-radius: 5px; }
        #rainfall-chart { width: 100%; height: 300px; }
        .recommendation-stats { display: none; margin-top: 20px; padding: 15px; background: #ffffff; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .yield-chart-container { margin-top: 20px; max-height: 600px; overflow-y: auto; width: 100%; }
        #yield-chart, #seasonal-chart, #popularity-chart { width: 100% !important; height: 400px !important; display: block; }
        /* Farmer Walking Animation CSS */
        .loader {
          scale: 0.75;
          position: relative;
          width: 200px;
          height: 200px;
          translate: 10px -20px;
        }
        .loader svg {
          position: absolute;
          top: 0;
          left: 0;
        }
        .head {
          translate: 27px -30px;
          z-index: 3;
          animation: bob 1s infinite ease-in;
        }
        .bod {
          translate: 0px 30px;
          z-index: 3;
          animation: bob 1s infinite ease-in-out;
        }
        .legr {
          translate: 75px 135px;
          z-index: 0;
          animation: rstep 1s infinite ease-in;
        }
        .legr {
          animation-delay: 0.45s;
        }
        .legl {
          translate: 30px 155px;
          z-index: 3;
          animation: lstep 1s infinite ease-in;
        }
        @keyframes bob {
          0% {
            transform: translateY(0) rotate(3deg);
          }
          5% {
            transform: translateY(0) rotate(3deg);
          }
          25% {
            transform: translateY(5px) rotate(0deg);
          }
          50% {
            transform: translateY(0px) rotate(-3deg);
          }
          70% {
            transform: translateY(5px) rotate(0deg);
          }
          100% {
            transform: translateY(0) rotate(3deg);
          }
        }
        @keyframes lstep {
          0% {
            transform: translateY(0) rotate(-5deg);
          }
          33% {
            transform: translateY(-15px) translate(32px) rotate(35deg);
          }
          66% {
            transform: translateY(0) translate(25px) rotate(-25deg);
          }
          100% {
            transform: translateY(0) rotate(-5deg);
          }
        }
        @keyframes rstep {
          0% {
            transform: translateY(0) translate(0px) rotate(-5deg);
          }
          33% {
            transform: translateY(-10px) translate(30px) rotate(35deg);
          }
          66% {
            transform: translateY(0) translate(20px) rotate(-25deg);
          }
          100% {
            transform: translateY(0) translate(0px) rotate(-5deg);
          }
        }
        #gnd {
          translate: -140px 0;
          rotate: 10deg;
          z-index: -1;
          filter: blur(0.5px) drop-shadow(1px 3px 5px #000000);
          opacity: 0.25;
          animation: scroll 5s infinite linear;
        }
        @keyframes scroll {
          0% {
            transform: translateY(25px) translate(50px);
            opacity: 0;
          }
          33% {
            opacity: 0.25;
          }
          66% {
            opacity: 0.25;
          }
          to {
            transform: translateY(-50px) translate(-100px);
            opacity: 0;
          }
        }
    </style>
</head>
<body>
    <div id="terms">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="AgriBuddy Logo">
        <h2>Welcome to AgriBuddy</h2>
        <label class="neon-checkbox">
            <input type="checkbox" id="agree" />
            <div class="neon-checkbox__frame">
                <div class="neon-checkbox__box">
                    <div class="neon-checkbox__check-container">
                        <svg viewBox="0 0 24 24" class="neon-checkbox__check">
                            <path d="M3,12.5l7,7L21,5"></path>
                        </svg>
                    </div>
                    <div class="neon-checkbox__glow"></div>
                    <div class="neon-checkbox__borders">
                        <span></span><span></span><span></span><span></span>
                    </div>
                </div>
                <div class="neon-checkbox__effects">
                    <div class="neon-checkbox__particles">
                        <span></span><span></span><span></span><span></span>
                        <span></span><span></span><span></span><span></span>
                        <span></span><span></span><span></span><span></span>
                    </div>
                    <div class="neon-checkbox__rings">
                        <div class="ring"></div>
                        <div class="ring"></div>
                        <div class="ring"></div>
                    </div>
                    <div class="neon-checkbox__sparks">
                        <span></span><span></span><span></span><span></span>
                    </div>
                </div>
            </div>
        </label>
        <span style="margin-left: 10px;">I agree to use AgriBuddy for crop guidance</span><br><br>
        <button class="animated-button" onclick="loadApp()">
            <svg viewBox="0 0 24 24" class="arr-2" xmlns="http://www.w3.org/2000/svg">
                <path d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"></path>
            </svg>
            <span class="text">Enter AgriBuddy</span>
            <span class="circle"></span>
            <svg viewBox="0 0 24 24" class="arr-1" xmlns="http://www.w3.org/2000/svg">
                <path d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"></path>
            </svg>
        </button>
    </div>
    <div id="content">
        <nav class="navbar navbar-expand-lg">
            <div class="container">
                <a class="navbar-brand" href="{{ url_for('index', tab='home') }}">
                    <img src="{{ url_for('static', filename='logo.png') }}" alt="AgriBuddy Logo">
                    AgriBuddy
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link {% if tab == 'recommendation' %}active{% endif %}" href="{{ url_for('index', tab='recommendation') }}">Crop Recommendation</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if tab == 'rainfall' %}active{% endif %}" href="{{ url_for('index', tab='rainfall') }}">Rainfall Prediction</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if tab == 'health' %}active{% endif %}" href="{{ url_for('index', tab='health') }}">Crop Health</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if tab == 'about' %}active{% endif %}" href="{{ url_for('index', tab='about') }}">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if tab == 'contact' %}active{% endif %}" href="{{ url_for('index', tab='contact') }}">Contact</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <div class="tab-content container my-5" style="flex: 1; min-height: 100vh;">
            <div class="tab-pane fade {% if tab == 'home' %}show active{% endif %}" id="home" role="tabpanel">
                <div class="hero d-flex align-items-center justify-content-center text-center">
                    <div class="hero-content animate-on-scroll">
                        <p class="text-uppercase fw-semibold mb-2" style="letter-spacing:6px;">Precision Farming Toolkit</p>
                        <h1>AgriBuddy: Cultivating the Future with AI</h1>
                        <p class="mt-3 mb-4">Analyze soil, predict rainfall, and diagnose crop health with interactive dashboards and computer vision models tailored for Indian agriculture.</p>
                        <div class="d-flex flex-wrap gap-3 justify-content-center">
                            <a href="{{ url_for('index', tab='recommendation') }}" class="get-started-btn me-2">Get Started</a>
                            <button id="bottone1" onclick="scrollToFeatures()"><strong>Discover Features</strong></button>
                        </div>
                    </div>
                    <div class="scroll-indicator" onclick="scrollToFeatures()">
                        Scroll Down
                        <span>⌄</span>
                    </div>
                </div>
                <div id="features" class="gradient-section animate-on-scroll mt-5">
                    <h2 class="text-center mb-2">Our Features</h2>
                    <div class="section-divider"></div>
                    <div class="row justify-content-center">
                        <div class="col-md-4 animate-on-scroll">
                            <div class="card" onclick="switchTab('health')">
                                <div class="content">
                                    <i class="fas fa-leaf"></i>
                                    <p class="para">
                                        <strong>Crop Health</strong><br>
                                        Check crop diseases and soil conditions instantly with AI-powered analysis.
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 animate-on-scroll">
                            <div class="card" onclick="switchTab('rainfall')">
                                <div class="content">
                                    <i class="fas fa-cloud-rain"></i>
                                    <p class="para">
                                        <strong>Rainfall Prediction</strong><br>
                                        Predict rainfall patterns for smarter farming using advanced forecasting models.
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 animate-on-scroll">
                            <div class="card" onclick="switchTab('recommendation')">
                                <div class="content">
                                    <i class="fas fa-seedling"></i>
                                    <p class="para">
                                        <strong>Crop Recommendation</strong><br>
                                        Find the best crops for your soil and season with data-driven insights.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="about-home" class="row mt-5 g-4 align-items-center animate-on-scroll">
                    <div class="col-md-6">
                        <div id="about-content" class="glass-panel">
                            <h2>AgriBuddy: Empowering the Future of Agriculture</h2>
                            <h3>Mission and Purpose</h3>
                            <p>AgriBuddy leverages Artificial Intelligence to deliver practical, data-driven tools for farmers, gardeners, students, researchers, and agriculture enthusiasts. By combining image-based soil classification, state-wise crop yield analytics, rainfall forecasting, and leaf health diagnostics, we provide instant insights tailored to Indian conditions. Our mission is to make precision agriculture accessible to all — starting in India, with a vision for sustainable, informed farming worldwide.</p>
                            <h3>Core Features</h3>
                            <h4>1. AI-Powered Crop Recommendation</h4>
                            <p>AgriBuddy uses a dual-filter system:<br>
                            - Soil type detection from uploaded soil images (CNN model)<br>
                            - State-specific yield optimization using 10+ years of government production data<br>
                            Recommends top-performing crops with national & state average yields (tons/ha), seasonal success index, and Hindi + English names. Includes interactive yield comparison, seasonal success, and regional popularity charts.</p>
                            <h4>2. Instant Crop Health Analysis</h4>
                            <p>Upload a leaf photo → AI detects 38+ plant diseases (deep CNN) and nutrient deficiencies (N, P, K, Mg, Fe) via HSV color spectrum analysis. Provides clear problem descriptions and practical solutions from verified agricultural knowledge.</p>
                            <h4>3. Data-Driven Rainfall Prediction</h4>
                            <p>Powered by Holt-Winters Exponential Smoothing on IMD subdivision-level historical data (1901–2017):<br>
                            - Predicts monthly rainfall for any future year<br>
                            - Classifies rainfall: Low | Medium | High<br>
                            - Flags anomalies (>20% deviation from historical average)<br>
                            - Recommends irrigation need and season-specific crops (Kharif | Rabi | Zaid)</p>
                            <h3>Advantages</h3>
                            <ul>
                                <li><strong>Accessible:</strong> Works on any device with a camera — no lab equipment needed.</li>
                                <li><strong>Instant:</strong> Results in seconds after image upload or form input.</li>
                                <li><strong>Data-Driven:</strong> Built on real government datasets (IMD, Ministry of Agriculture).</li>
                                <li><strong>Free:</strong> Fully open for learning, research, and practical use.</li>
                                <li><strong>Bilingual:</strong> Crop names and interface support English + Hindi.</li>
                            </ul>
                            <h3>Development Note</h3>
                            <p>AgriBuddy is an active academic and open-source project. AI models are trained on real-world data but are not 100% accurate. Use outputs as a guiding tool alongside local agricultural experts, KVKs, or soil testing labs. Your feedback directly improves the system.</p>
                            <h3>Future Vision</h3>
                            <p>We aim to expand with multilingual support, mobile-first offline mode, and integration with regional crop calendars — all while staying free, open, and grounded in real Indian farming needs.</p>
                            <h3>Start Farming Smarter</h3>
                            <p>Join AgriBuddy to make informed, sustainable, and profitable agricultural decisions — whether you're in a field, classroom, or backyard garden.</p>
                        </div>
                    </div>
                    <div class="col-md-6 d-flex align-items-center justify-content-center">
                        <div class="loader">
                          <svg
                            class="legl"
                            version="1.1"
                            xmlns="http://www.w3.org/2000/svg"
                            width="20.69332"
                            height="68.19944"
                            viewBox="0,0,20.69332,68.19944"
                          >
                            <g transform="translate(-201.44063,-235.75466)">
                              <g stroke-miterlimit="10">
                                <path d="" fill="#ffffff" stroke="none" stroke-width="0.5"></path>
                                <path
                                  d=""
                                  fill-opacity="0.26667"
                                  fill="#97affd"
                                  stroke-opacity="0.48627"
                                  stroke="#ffffff"
                                  stroke-width="0"
                                ></path>
                                <path
                                  d="M218.11971,301.20087c-2.20708,1.73229 -4.41416,0 -4.41416,0l-1.43017,-1.1437c-1.42954,-1.40829 -3.04351,-2.54728 -4.56954,-3.87927c-0.95183,-0.8308 -2.29837,-1.49883 -2.7652,-2.55433c-0.42378,-0.95815 0.14432,-2.02654 0.29355,-3.03399c0.41251,-2.78499 1.82164,-5.43386 2.41472,-8.22683c1.25895,-4.44509 2.73863,-8.98683 3.15318,-13.54796c0.22615,-2.4883 -0.21672,-5.0155 -0.00278,-7.50605c0.30636,-3.56649 1.24602,-7.10406 1.59992,-10.6738c0.29105,-2.93579 -0.00785,-5.9806 -0.00785,-8.93046c0,0 0,-2.44982 3.12129,-2.44982c3.12129,0 3.12129,2.44982 3.12129,2.44982c0,3.06839 0.28868,6.22201 -0.00786,9.27779c-0.34637,3.56935 -1.30115,7.10906 -1.59992,10.6738c-0.2103,2.50918 0.22586,5.05326 -0.00278,7.56284c-0.43159,4.7371 -1.94029,9.46317 -3.24651,14.07835c-0.47439,2.23403 -1.29927,4.31705 -2.05805,6.47156c-0.18628,0.52896 -0.1402,1.0974 -0.327,1.62624c-0.09463,0.26791 -0.64731,0.47816 -0.50641,0.73323c0.19122,0.34617 0.86423,0.3445 1.2346,0.58502c1.88637,1.22503 3.50777,2.79494 5.03,4.28305l0.96971,0.73991c0,0 2.20708,1.73229 0,3.46457z"
                                  fill="none"
                                  stroke="#191e2e"
                                  stroke-width="7"
                                ></path>
                              </g>
                            </g>
                          </svg>
                          <svg
                            class="legr"
                            version="1.1"
                            xmlns="http://www.w3.org/2000/svg"
                            width="41.02537"
                            height="64.85502"
                            viewBox="0,0,41.02537,64.85502"
                          >
                            <g transform="translate(-241.54137,-218.44347)">
                              <g stroke-miterlimit="10">
                                <path
                                  d="M279.06674,279.42662c-2.27967,1.98991 -6.08116,0.58804 -6.08116,0.58804l-2.47264,-0.92915c-2.58799,-1.18826 -5.31176,-2.08831 -7.99917,-3.18902c-1.67622,-0.68654 -3.82471,-1.16116 -4.93147,-2.13229c-1.00468,-0.88156 -0.69132,-2.00318 -0.92827,-3.00935c-0.65501,-2.78142 0.12275,-5.56236 -0.287,-8.37565c-0.2181,-4.51941 -0.17458,-9.16283 -1.60696,-13.68334c-0.78143,-2.46614 -2.50162,-4.88125 -3.30086,-7.34796c-1.14452,-3.53236 -1.40387,-7.12078 -2.48433,-10.66266c-0.88858,-2.91287 -2.63779,-5.85389 -3.93351,-8.74177c0,0 -1.07608,-2.39835 3.22395,-2.81415c4.30003,-0.41581 2.41605,1.98254 2.41605,1.98254c1.34779,3.00392 3.13072,6.05282 4.06444,9.0839c1.09065,3.54049 1.33011,7.13302 2.48433,10.66266c0.81245,2.48448 2.5308,4.917 3.31813,7.40431c1.48619,4.69506 1.48366,9.52281 1.71137,14.21503c0.32776,2.25028 0.10631,4.39942 0.00736,6.60975c-0.02429,0.54266 0.28888,1.09302 0.26382,1.63563c-0.01269,0.27488 -0.68173,0.55435 -0.37558,0.78529c0.41549,0.31342 1.34191,0.22213 1.95781,0.40826c3.13684,0.94799 6.06014,2.26892 8.81088,3.52298l1.66093,0.59519c0,0 6.76155,1.40187 4.48187,3.39177z"
                                  fill="none"
                                  stroke="#000000"
                                  stroke-width="7"
                                ></path>
                                <path d="" fill="#ffffff" stroke="none" stroke-width="0.5"></path>
                                <path
                                  d=""
                                  fill-opacity="0.26667"
                                  fill="#97affd"
                                  stroke-opacity="0.48627"
                                  stroke="#ffffff"
                                  stroke-width="0"
                                ></path>
                              </g>
                            </g>
                          </svg>
                          <div class="bod">
                            <svg
                              version="1.1"
                              xmlns="http://www.w3.org/2000/svg"
                              width="144.10576"
                              height="144.91623"
                              viewBox="0,0,144.10576,144.91623"
                            >
                              <g transform="translate(-164.41679,-112.94712)">
                                <g stroke-miterlimit="10">
                                  <path
                                    d="M166.9168,184.02633c0,-36.49454 35.0206,-66.07921 72.05288,-66.07921c37.03228,0 67.05288,29.58467 67.05288,66.07921c0,6.94489 -1.08716,13.63956 -3.10292,19.92772c-2.71464,8.46831 -7.1134,16.19939 -12.809,22.81158c-2.31017,2.68194 -7.54471,12.91599 -7.54471,12.91599c0,0 -5.46714,-1.18309 -8.44434,0.6266c-3.86867,2.35159 -10.95356,10.86714 -10.95356,10.86714c0,0 -6.96906,-3.20396 -9.87477,-2.58085c-2.64748,0.56773 -6.72538,5.77072 -6.72538,5.77072c0,0 -5.5023,-4.25969 -7.5982,-4.25969c-3.08622,0 -9.09924,3.48259 -9.09924,3.48259c0,0 -6.0782,-5.11244 -9.00348,-5.91884c-4.26461,-1.17561 -12.23343,0.75049 -12.23343,0.75049c0,0 -5.18164,-8.26065 -7.60688,-9.90388c-3.50443,-2.37445 -8.8271,-3.95414 -8.8271,-3.95414c0,0 -5.33472,-8.81718 -7.27019,-11.40895c-4.81099,-6.44239 -13.46422,-9.83437 -15.65729,-17.76175c-1.53558,-5.55073 -2.35527,-21.36472 -2.35527,-21.36472z"
                                    fill="#191e2e"
                                    stroke="#000000"
                                    stroke-width="5"
                                    stroke-linecap="butt"
                                  ></path>
                                  <path
                                    d="M167.94713,180c0,-37.03228 35.0206,-67.05288 72.05288,-67.05288c37.03228,0 67.05288,30.0206 67.05288,67.05288c0,7.04722 -1.08716,13.84053 -3.10292,20.22135c-2.71464,8.59309 -7.1134,16.43809 -12.809,23.14771c-2.31017,2.72146 -7.54471,13.1063 -7.54471,13.1063c0,0 -5.46714,-1.20052 -8.44434,0.63584c-3.86867,2.38624 -10.95356,11.02726 -10.95356,11.02726c0,0 -6.96906,-3.25117 -9.87477,-2.61888c-2.64748,0.5761 -6.72538,5.85575 -6.72538,5.85575c0,0 -5.5023,-4.32246 -7.5982,-4.32246c-3.08622,0 -9.09924,3.5339 -9.09924,3.5339c0,0 -6.0782,-5.18777 -9.00348,-6.00605c-4.26461,-1.19293 -12.23343,0.76155 -12.23343,0.76155c0,0 -5.18164,-8.38236 -7.60688,-10.04981c-3.50443,-2.40943 -8.8271,-4.0124 -8.8271,-4.0124c0,0 -5.33472,-8.9471 -7.27019,-11.57706c-4.81099,-6.53732 -13.46422,-9.97928 -15.65729,-18.02347c-1.53558,-5.63252 -2.35527,-21.67953 -2.35527,-21.67953z"
                                    fill="#191e2e"
                                    stroke="none"
                                    stroke-width="0"
                                    stroke-linecap="butt"
                                  ></path>
                                  <path
                                    d=""
                                    fill="#ffffff"
                                    stroke="none"
                                    stroke-width="0.5"
                                    stroke-linecap="butt"
                                  ></path>
                                  <path
                                    d=""
                                    fill-opacity="0.26667"
                                    fill="#97affd"
                                    stroke-opacity="0.48627"
                                    stroke="#ffffff"
                                    stroke-width="0"
                                    stroke-linecap="butt"
                                  ></path>
                                  <path
                                    d="M216.22445,188.06994c0,0 1.02834,11.73245 -3.62335,21.11235c-4.65169,9.3799 -13.06183,10.03776 -13.06183,10.03776c0,0 7.0703,-3.03121 10.89231,-10.7381c4.34839,-8.76831 5.79288,-20.41201 5.79288,-20.41201z"
                                    fill="none"
                                    stroke="#2f3a50"
                                    stroke-width="3"
                                    stroke-linecap="round"
                                  ></path>
                                </g>
                              </g>
                            </svg>
                            <svg
                              class="head"
                              version="1.1"
                              xmlns="http://www.w3.org/2000/svg"
                              width="115.68559"
                              height="88.29441"
                              viewBox="0,0,115.68559,88.29441"
                            >
                              <g transform="translate(-191.87889,-75.62023)">
                                <g stroke-miterlimit="10">
                                  <path
                                    d=""
                                    fill="#ffffff"
                                    stroke="none"
                                    stroke-width="0.5"
                                    stroke-linecap="butt"
                                  ></path>
                                  <path
                                    d="M195.12889,128.77752c0,-26.96048 21.33334,-48.81626 47.64934,-48.81626c26.316,0 47.64935,21.85578 47.64935,48.81626c0,0.60102 -9.22352,20.49284 -9.22352,20.49284l-7.75885,0.35623l-7.59417,6.15039l-8.64295,-1.74822l-11.70703,6.06119l-6.38599,-4.79382l-6.45999,2.36133l-7.01451,-7.38888l-8.11916,1.29382l-6.19237,-6.07265l-7.6263,-1.37795l-4.19835,-7.87062l-4.24236,-4.16907c0,0 -0.13314,-2.0999 -0.13314,-3.29458z"
                                    fill="none"
                                    stroke="#2f3a50"
                                    stroke-width="6"
                                    stroke-linecap="butt"
                                  ></path>
                                  <path
                                    d="M195.31785,124.43649c0,-26.96048 21.33334,-48.81626 47.64934,-48.81626c26.316,0 47.64935,21.85578 47.64935,48.81626c0,1.03481 -0.08666,2.8866 -0.08666,2.8866c0,0 16.8538,15.99287 16.21847,17.23929c-0.66726,1.30905 -23.05667,-4.14265 -23.05667,-4.14265l-2.29866,4.5096l-7.75885,0.35623l-7.59417,6.15039l-8.64295,-1.74822l-11.70703,6.06119l-6.38599,-4.79382l-6.45999,2.36133l-7.01451,-7.38888l-8.11916,1.29382l-6.19237,-6.07265l-7.6263,-1.37795l-4.19835,-7.87062l-4.24236,-4.16907c0,0 -0.13314,-2.0999 -0.13314,-3.29458z"
                                    fill="#191e2e"
                                    stroke-opacity="0.48627"
                                    stroke="#ffffff"
                                    stroke-width="0"
                                    stroke-linecap="butt"
                                  ></path>
                                  <path
                                    d="M271.10348,122.46768l10.06374,-3.28166l24.06547,24.28424"
                                    fill="none"
                                    stroke="#2f3a50"
                                    stroke-width="6"
                                    stroke-linecap="round"
                                  ></path>
                                  <path
                                    d="M306.56448,144.85764l-41.62024,-8.16845l2.44004,-7.87698"
                                    fill="none"
                                    stroke="#000000"
                                    stroke-width="3.5"
                                    stroke-linecap="round"
                                  ></path>
                                  <path
                                    d="M276.02738,115.72434c-0.66448,-4.64715 2.56411,-8.95308 7.21127,-9.61756c4.64715,-0.66448 8.95309,2.56411 9.61757,7.21126c0.46467,3.24972 -1.94776,8.02206 -5.96624,9.09336c-2.11289,-1.73012 -5.08673,-5.03426 -5.08673,-5.03426c0,0 -4.12095,1.16329 -4.60481,1.54229c-0.16433,-0.04891 -0.62732,-0.38126 -0.72803,-0.61269c-0.30602,-0.70328 -0.36302,-2.02286 -0.44303,-2.58239z"
                                    fill="#ffffff"
                                    stroke="none"
                                    stroke-width="0.5"
                                    stroke-linecap="butt"
                                  ></path>
                                  <path
                                    d="M242.49281,125.6424c0,-4.69442 3.80558,-8.5 8.5,-8.5c4.69442,0 8.5,3.80558 8.5,8.5c0,4.69442 -3.80558,8.5 -8.5,8.5c-4.69442,0 -8.5,-3.80558 -8.5,-8.5z"
                                    fill="#ffffff"
                                    stroke="none"
                                    stroke-width="0.5"
                                    stroke-linecap="butt"
                                  ></path>
                                  <path
                                    d=""
                                    fill-opacity="0.26667"
                                    fill="#97affd"
                                    stroke-opacity="0.48627"
                                    stroke="#ffffff"
                                    stroke-width="0"
                                    stroke-linecap="butt"
                                  ></path>
                                </g>
                              </g>
                            </svg>
                          </div>
                          <svg
                            id="gnd"
                            version="1.1"
                            xmlns="http://www.w3.org/2000/svg"
                            width="475"
                            height="530"
                            viewBox="0,0,163.40011,85.20095"
                          >
                            <g transform="translate(-176.25,-207.64957)">
                              <g
                                stroke="#000000"
                                stroke-width="2.5"
                                stroke-linecap="round"
                                stroke-miterlimit="10"
                              >
                                <path
                                  d="M295.5,273.1829c0,0 -57.38915,6.69521 -76.94095,-9.01465c-13.65063,-10.50609 15.70098,-20.69467 -2.5451,-19.94465c-30.31027,2.05753 -38.51396,-26.84135 -38.51396,-26.84135c0,0 6.50084,13.30023 18.93224,19.17888c9.53286,4.50796 26.23632,-1.02541 32.09529,4.95137c3.62417,3.69704 2.8012,6.33005 0.66517,8.49452c-3.79415,3.84467 -11.7312,6.21103 -6.24682,10.43645c22.01082,16.95812 72.55412,12.73944 72.55412,12.73944z"
                                  fill="#000000"
                                ></path>
                                <path
                                  d="M338.92138,217.76285c0,0 -17.49626,12.55408 -45.36424,10.00353c-8.39872,-0.76867 -17.29557,-6.23066 -17.29557,-6.23066c0,0 3.06461,-2.23972 15.41857,0.72484c26.30467,6.31228 47.24124,-4.49771 47.24124,-4.49771z"
                                  fill="#000000"
                                ></path>
                                <path
                                  d="M209.14443,223.00182l1.34223,15.4356l-10.0667,-15.4356"
                                  fill="none"
                                ></path>
                                <path
                                  d="M198.20391,230.41806l12.95386,7.34824l6.71113,-12.08004"
                                  fill="none"
                                ></path>
                                <path d="M211.19621,238.53825l8.5262,-6.09014" fill="none"></path>
                                <path
                                  d="M317.57068,215.80173l5.27812,6.49615l0.40601,-13.39831"
                                  fill="none"
                                ></path>
                                <path d="M323.66082,222.70389l6.09014,-9.33822" fill="none"></path>
                              </g>
                            </g>
                          </svg>
                        </div>
                    </div>
                </div>
                <div id="contact-home" class="row mt-5 animate-on-scroll">
                    <div class="col-12 glass-panel">
                        <h2>Contact Us</h2>
                        <p>For any queries or feedback, please email us at <a href="mailto:vasisthakv@gmail.com">vasisthakv@gmail.com</a>.</p>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade {% if tab == 'recommendation' %}show active{% endif %}" id="recommendation" role="tabpanel">
                <div class="loading" id="recommendation-loading"><div class="spinner"></div> AgriBuddy is loading</div>
                <p class="text-center text-muted">Click on a state on the map or select from the dropdown below.</p>
                <div id="india-map"></div>
                <form method="POST" action="{{ url_for('index', tab='recommendation') }}" enctype="multipart/form-data" id="recommendation-form">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="image" class="form-label"><b>1. Upload Soil Image</b></label>
                            <input type="file" name="image" id="image" class="form-control" accept="image/*" onchange="previewImage(event, 'soil-preview')">
                            <button type="button" class="btn btn-secondary mt-2" onclick="accessCamera('image')">Access Camera</button>
                            <img id="soil-preview" class="uploaded-image img-fluid d-block mx-auto" style="display:none;">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="state-dropdown" class="form-label"><b>2. Select Your State</b></label>
                            <select name="state" id="state-dropdown" class="form-select" required>
                                <option value="" disabled {% if not selected_state %}selected{% endif %}>-- Select Your State / अपना राज्य चुनें --</option>
                                {% for state in states %}
                                <option value="{{ state.english }}" {% if selected_state == state.english %}selected{% endif %}>
                                    {{ state.english }} / {{ state.hindi }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <button type="button" class="animated-button" onclick="submitFormWithLoading('recommendation')">
                            <svg viewBox="0 0 24 24" class="arr-2" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"></path>
                            </svg>
                            <span class="text">Get Recommendation</span>
                            <span class="circle"></span>
                            <svg viewBox="0 0 24 24" class="arr-1" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"></path>
                            </svg>
                        </button>
                    </div>
                </form>
                {% if result and recommendations %}
                <div class="mt-5 p-4" style="background: #ffffff; border-radius: 15px; box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);">
                    <h2 class="text-center mb-4">Your Results</h2>
                    <div class="alert alert-success">
                        <p class="mb-1"><strong>Predicted Soil Type:</strong> {{ result.soil_type }}</p>
                        <p class="mb-0"><strong>State:</strong> {{ result.state }}</p>
                    </div>
                    <h3 class="mt-4">Top Crop Recommendations:</h3>
                    <div class="row mt-3">
                        {% for rec in recommendations %}
                        <div class="col-lg-4 col-md-6 mb-4">
                            <div class="crop-item" data-name="{{ rec.name }}">
                                {% if rec.name|lower + '.jpg' in static_files %}
                                <img src="{{ url_for('static', filename='crop_images/' + rec.name|lower + '.jpg') }}" class="recommendation-img img-fluid" alt="{{ rec.name.title() }}">
                                {% else %}
                                <div class="no-image">Image not available</div>
                                {% endif %}
                                <p>{{ rec.name.title() }} / {{ rec.details.hindi_name|default('N/A') }}</p>
                            </div>
                            <div class="crop-details" id="details-{{ loop.index0 }}">
                                <strong>Best Season:</strong> {{ rec.details.season|default('Unknown') }}<br>
                                <strong>Ideal Conditions:</strong><br>
                                Temp: {{ "%.1f"|format(rec.details.temp|default(0)) }}°C<br>
                                Rain: {{ "%.1f"|format(rec.details.rain|default(0)) }}mm<br>
                                pH: {{ "%.1f"|format(rec.details.ph|default(0)) }}
                            </div>
                        </div>
                        {% endfor %}
                        {% if recommendations|length == 0 %}
                        <div class="alert alert-warning mt-3">No recommendations available.</div>
                        {% endif %}
                    </div>
                    {% if recommendations|length > 0 %}
                    <div class="text-center mt-4">
                        <button type="button" class="animated-button" id="show-rec-stats-btn">
                            <svg viewBox="0 0 24 24" class="arr-2" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"></path>
                            </svg>
                            <span class="text">Show Stats</span>
                            <span class="circle"></span>
                            <svg viewBox="0 0 24 24" class="arr-1" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="recommendation-stats" id="rec-stats">
                        <h4 class="mb-3">Yield Statistics (tons/ha)</h4>
                        <div class="row">
                            {% for item in rec_yield_data %}
                            <div class="col-md-6 mb-3">
                                <h5>{{ item.crop }}</h5>
                                <p><strong>{{ selected_state.title() if selected_state else 'State' }} Average:</strong> {{ item.state if item.state is not none else 'N/A' }}</p>
                                <p><strong>National Average:</strong> {{ item.national if item.national is not none else 'N/A' }}</p>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="yield-chart-container">
                            <h5>Yield Comparison</h5>
                            <canvas id="yield-chart"></canvas>
                        </div>
                        <div class="yield-chart-container">
                            <h5>Seasonal Success</h5>
                            <canvas id="seasonal-chart"></canvas>
                        </div>
                        <div class="yield-chart-container">
                            <h5>Regional Popularity by Yield</h5>
                            <canvas id="popularity-chart"></canvas>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
                {% if error_message %}
                <div class="alert alert-danger mt-3">{{ error_message }}</div>
                {% endif %}
            </div>
            <div class="tab-pane fade {% if tab == 'rainfall' %}show active{% endif %}" id="rainfall" role="tabpanel">
                <div class="loading" id="rainfall-loading"><div class="spinner"></div> AgriBuddy is loading</div>
                <form method="POST" action="{{ url_for('index', tab='rainfall') }}" id="rainfall-form">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="subdivision" class="form-label"><b>1. Select Subdivision</b></label>
                            <select name="subdivision" id="subdivision" class="form-select" required>
                                <option value="" disabled {% if not subdivision %}selected{% endif %}>-- Select Subdivision --</option>
                                {% for sub in subdivisions %}
                                <option value="{{ sub }}">{{ sub }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="year" class="form-label"><b>2. Enter Year</b></label>
                            <input type="number" name="year" id="year" class="form-control" value="2005" required>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="month" class="form-label"><b>3. Select Month</b></label>
                            <select name="month" id="month" class="form-select" required>
                                <option value="" disabled {% if not month %}selected{% endif %}>-- Select Month --</option>
                                <option value="JAN">January</option>
                                <option value="FEB">February</option>
                                <option value="MAR">March</option>
                                <option value="APR">April</option>
                                <option value="MAY">May</option>
                                <option value="JUN">June</option>
                                <option value="JUL">July</option>
                                <option value="AUG">August</option>
                                <option value="SEP">September</option>
                                <option value="OCT">October</option>
                                <option value="NOV">November</option>
                                <option value="DEC">December</option>
                            </select>
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <button type="button" class="animated-button" onclick="submitFormWithLoading('rainfall')">
                            <svg viewBox="0 0 24 24" class="arr-2" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"></path>
                            </svg>
                            <span class="text">Predict Rainfall</span>
                            <span class="circle"></span>
                            <svg viewBox="0 0 24 24" class="arr-1" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"></path>
                            </svg>
                        </button>
                    </div>
                </form>
                {% if rainfall_result %}
                {% set abs_anomaly_percent = ((predicted_rainfall - historical_avg) / historical_avg * 100)|round(1)|abs if historical_avg is not none and historical_avg != 0 else 0 %}
                <script>
                    window.hasAnomaly = {{ (abs_anomaly_percent > 20)|tojson }};
                </script>
                <div class="mt-5 p-4" style="background: #ffffff; border-radius: 15px; box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);">
                    <h2 class="text-center mb-4">Your Results</h2>
                    <div class="alert alert-success">
                        <p class="mb-1"><strong>Rainfall Prediction:</strong> {{ rainfall_result }}</p>
                        {% if rainfall_classification %}
                        <p class="mb-1"><strong>Rainfall Classification:</strong> {{ rainfall_classification }}</p>
                        {% endif %}
                        {% if season %}
                        <p class="mb-0"><strong>Season:</strong> {{ season }}</p>
                        {% endif %}
                    </div>
                    {% if crop_suggestions %}
                    <h3 class="mt-4">Top Crop Suggestions:</h3>
                    <div class="row mt-3">
                        {% for rec in crop_suggestions %}
                        <div class="col-lg-4 col-md-6 mb-4">
                            <div class="crop-item" data-name="{{ rec.get('name', 'Unknown') }}">
                                {% if rec.get('name', '').lower() + '.jpg' in static_files %}
                                <img src="{{ url_for('static', filename='crop_images/' + rec.get('name', '').lower() + '.jpg') }}" class="recommendation-img img-fluid" alt="{{ rec.get('name', 'Unknown').title() }}">
                                {% else %}
                                <div class="no-image">Image not available for {{ rec.get('name', 'Unknown').title() }}</div>
                                {% endif %}
                                <p>{{ rec.get('name', 'Unknown').title() }} / {{ rec.get('details', {}).get('hindi_name', 'N/A') }}</p>
                            </div>
                            <div class="crop-details" id="details-{{ loop.index0 }}">
                                <strong>Best Season:</strong> {{ rec.get('details', {}).get('season', 'Unknown') }}<br>
                                <strong>Ideal Conditions:</strong><br>
                                Temp: {{ "%.1f"|format(rec.get('details', {}).get('temp', 0)) }}°C<br>
                                Rain: {{ "%.1f"|format(rec.get('details', {}).get('rain', 0)) }}mm<br>
                                pH: {{ "%.1f"|format(rec.get('details', {}).get('ph', 0)) }}
                            </div>
                        </div>
                        {% endfor %}
                        {% if crop_suggestions|length == 0 %}
                        <div class="alert alert-warning mt-3">No crop suggestions available.</div>
                        {% endif %}
                    </div>
                    {% else %}
                    <div class="alert alert-warning mt-3">No crop suggestions available.</div>
                    {% endif %}
                    {% if rainfall_error %}
                    <div class="alert alert-danger mt-3">{{ rainfall_error }}</div>
                    {% endif %}
                    <div class="text-center mt-4">
                        <button type="button" class="animated-button" id="show-stats-btn">
                            <svg viewBox="0 0 24 24" class="arr-2" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"></path>
                            </svg>
                            <span class="text">Show Stats</span>
                            <span class="circle"></span>
                            <svg viewBox="0 0 24 24" class="arr-1" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"></path>
                            </svg>
                        </button>
                        <button type="button" class="animated-button ms-2" id="details-btn" style="display: none;">
                            <svg viewBox="0 0 24 24" class="arr-2" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"></path>
                            </svg>
                            <span class="text">Details</span>
                            <span class="circle"></span>
                            <svg viewBox="0 0 24 24" class="arr-1" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="rainfall-stats" id="rainfall-stats">
                        {% if historical_avg is not none and predicted_rainfall is not none %}
                        <p><strong>Historical Average Rainfall:</strong> {{ "%.1f"|format(historical_avg) }} mm</p>
                        {% set anomaly_percent = ((predicted_rainfall - historical_avg) / historical_avg * 100)|round(1) %}
                        {% set deviation_mm = (predicted_rainfall - historical_avg)|round(1) %}
                        {% set abs_anomaly_percent = anomaly_percent|abs %}
                        {% set abs_deviation_mm = deviation_mm|abs %}
                        {% if abs_anomaly_percent > 20 %}
                        <div class="rainfall-anomaly">
                            {% if deviation_mm > 0 %}
                            <p><strong>Anomaly:</strong> {{ abs_deviation_mm }} mm more rain than historical average of {{ "%.1f"|format(historical_avg) }} mm – Irrigation {{ 'recommended' if irrigation_recommendation and 'recommended' in irrigation_recommendation else 'not needed' }}.</p>
                            {% else %}
                            <p><strong>Anomaly:</strong> {{ abs_deviation_mm }} mm less rain than historical average of {{ "%.1f"|format(historical_avg) }} mm – Irrigation {{ 'recommended' if irrigation_recommendation and 'recommended' in irrigation_recommendation else 'not needed' }}.</p>
                            {% endif %}
                        </div>
                        {% endif %}
                        {% if irrigation_recommendation %}
                        <div class="{% if 'recommended' in irrigation_recommendation %}irrigation-needed{% else %}irrigation-not-needed{% endif %}">
                            <p><strong>Irrigation Recommendation:</strong> {{ irrigation_recommendation }}</p>
                        </div>
                        {% endif %}
                        <div id="anomaly-details" style="display:none; margin-top:10px; padding:10px; background:#f9f9f9; border-radius:5px;">
                            {% if abs_anomaly_percent > 20 %}
                            <p>Deviation: {{ anomaly_percent }}% from historical average ({{ "%.1f"|format(predicted_rainfall) }} mm predicted vs. {{ "%.1f"|format(historical_avg) }} mm average).</p>
                            {% if anomaly_percent > 0 %}
                            <span style="color:green;">Surplus rainfall</span>
                            {% else %}
                            <span style="color:red;">Rainfall deficit</span>
                            {% endif %}
                            {% endif %}
                        </div>
                        <div id="rainfall-chart"></div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            </div>
            <div class="tab-pane fade {% if tab == 'health' %}show active{% endif %}" id="health" role="tabpanel">
                <div class="loading" id="health-loading"><div class="spinner"></div> AgriBuddy is loading</div>
                <form method="POST" action="{{ url_for('index', tab='health') }}" enctype="multipart/form-data" id="health-form">
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label for="leaf_image" class="form-label"><b>Upload or Capture Leaf Image</b></label>
                            <input type="file" name="leaf_image" id="leaf_image" class="form-control" accept="image/*" onchange="previewImage(event, 'health-preview')">
                            <button type="button" class="btn btn-secondary mt-2" onclick="accessCamera('leaf_image')">Access Camera</button>
                            <img id="health-preview" class="uploaded-image img-fluid d-block mx-auto" style="display:none;">
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <button type="button" class="animated-button" onclick="submitFormWithLoading('health')">
                            <svg viewBox="0 0 24 24" class="arr-2" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"></path>
                            </svg>
                            <span class="text">Analyze Health</span>
                            <span class="circle"></span>
                            <svg viewBox="0 0 24 24" class="arr-1" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"></path>
                            </svg>
                        </button>
                    </div>
                </form>
                {% if health_image_path %}
                <img src="{{ health_image_path }}" alt="Uploaded Leaf Image" class="uploaded-image img-fluid d-block mx-auto">
                {% endif %}
                {% if health_result %}
                <div class="mt-5 p-4" style="background: #ffffff; border-radius: 15px; box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);">
                    <h2 class="text-center mb-4">Health Analysis</h2>
                    <div class="alert alert-info">
                        <p class="mb-1"><strong>Detected Issue:</strong> {{ health_result.issue }}</p>
                        <p class="mb-1"><strong>Description:</strong> {{ health_result.description }}</p>
                        <p class="mb-0"><strong>Solutions:</strong> {{ health_result.solutions }}</p>
                    </div>
                    <img src="{{ url_for('static', filename='healthy_plant.png') if health_result.issue == 'Healthy' else url_for('static', filename='unhealthy_plant.png') }}" alt="Health Indicator" class="health-indicator img-fluid d-block mx-auto">
                </div>
                {% endif %}
                {% if health_error %}
                <div class="alert alert-danger mt-3">{{ health_error }}</div>
                {% endif %}
            </div>
            <div class="tab-pane fade {% if tab == 'about' %}show active{% endif %}" id="about" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div id="about-content" class="glass-panel">
                            <h2>AgriBuddy: Empowering the Future of Agriculture</h2>
                            <h3>Mission and Purpose</h3>
                            <p>AgriBuddy leverages Artificial Intelligence to deliver practical, data-driven tools for farmers, gardeners, students, researchers, and agriculture enthusiasts. By combining image-based soil classification, state-wise crop yield analytics, rainfall forecasting, and leaf health diagnostics, we provide instant insights tailored to Indian conditions. Our mission is to make precision agriculture accessible to all — starting in India, with a vision for sustainable, informed farming worldwide.</p>
                            <h3>Core Features</h3>
                            <h4>1. AI-Powered Crop Recommendation</h4>
                            <p>AgriBuddy uses a dual-filter system:<br>
                            - Soil type detection from uploaded soil images (CNN model)<br>
                            - State-specific yield optimization using 10+ years of government production data<br>
                            Recommends top-performing crops with national & state average yields (tons/ha), seasonal success index, and Hindi + English names. Includes interactive yield comparison, seasonal success, and regional popularity charts.</p>
                            <h4>2. Instant Crop Health Analysis</h4>
                            <p>Upload a leaf photo → AI detects 38+ plant diseases (deep CNN) and nutrient deficiencies (N, P, K, Mg, Fe) via HSV color spectrum analysis. Provides clear problem descriptions and practical solutions from verified agricultural knowledge.</p>
                            <h4>3. Data-Driven Rainfall Prediction</h4>
                            <p>Powered by Holt-Winters Exponential Smoothing on IMD subdivision-level historical data (1901–2017):<br>
                            - Predicts monthly rainfall for any future year<br>
                            - Classifies rainfall: Low | Medium | High<br>
                            - Flags anomalies (>20% deviation from historical average)<br>
                            - Recommends irrigation need and season-specific crops (Kharif | Rabi | Zaid)</p>
                            <h3>Advantages</h3>
                            <ul>
                                <li><strong>Accessible:</strong> Works on any device with a camera — no lab equipment needed.</li>
                                <li><strong>Instant:</strong> Results in seconds after image upload or form input.</li>
                                <li><strong>Data-Driven:</strong> Built on real government datasets (IMD, Ministry of Agriculture).</li>
                                <li><strong>Free:</strong> Fully open for learning, research, and practical use.</li>
                                <li><strong>Bilingual:</strong> Crop names and interface support English + Hindi.</li>
                            </ul>
                            <h3>Development Note</h3>
                            <p>AgriBuddy is an active academic and open-source project. AI models are trained on real-world data but are not 100% accurate. Use outputs as a guiding tool alongside local agricultural experts, KVKs, or soil testing labs. Your feedback directly improves the system.</p>
                            <h3>Future Vision</h3>
                            <p>We aim to expand with multilingual support, mobile-first offline mode, and integration with regional crop calendars — all while staying free, open, and grounded in real Indian farming needs.</p>
                            <h3>Start Farming Smarter</h3>
                            <p>Join AgriBuddy to make informed, sustainable, and profitable agricultural decisions — whether you're in a field, classroom, or backyard garden.</p>
                        </div>
                    </div>
                    <div class="col-md-6 d-flex align-items-center justify-content-center">
                        <div class="loader">
                          <svg
                            class="legl"
                            version="1.1"
                            xmlns="http://www.w3.org/2000/svg"
                            width="20.69332"
                            height="68.19944"
                            viewBox="0,0,20.69332,68.19944"
                          >
                            <g transform="translate(-201.44063,-235.75466)">
                              <g stroke-miterlimit="10">
                                <path d="" fill="#ffffff" stroke="none" stroke-width="0.5"></path>
                                <path
                                  d=""
                                  fill-opacity="0.26667"
                                  fill="#97affd"
                                  stroke-opacity="0.48627"
                                  stroke="#ffffff"
                                  stroke-width="0"
                                ></path>
                                <path
                                  d="M218.11971,301.20087c-2.20708,1.73229 -4.41416,0 -4.41416,0l-1.43017,-1.1437c-1.42954,-1.40829 -3.04351,-2.54728 -4.56954,-3.87927c-0.95183,-0.8308 -2.29837,-1.49883 -2.7652,-2.55433c-0.42378,-0.95815 0.14432,-2.02654 0.29355,-3.03399c0.41251,-2.78499 1.82164,-5.43386 2.41472,-8.22683c1.25895,-4.44509 2.73863,-8.98683 3.15318,-13.54796c0.22615,-2.4883 -0.21672,-5.0155 -0.00278,-7.50605c0.30636,-3.56649 1.24602,-7.10406 1.59992,-10.6738c0.29105,-2.93579 -0.00785,-5.9806 -0.00785,-8.93046c0,0 0,-2.44982 3.12129,-2.44982c3.12129,0 3.12129,2.44982 3.12129,2.44982c0,3.06839 0.28868,6.22201 -0.00786,9.27779c-0.34637,3.56935 -1.30115,7.10906 -1.59992,10.6738c-0.2103,2.50918 0.22586,5.05326 -0.00278,7.56284c-0.43159,4.7371 -1.94029,9.46317 -3.24651,14.07835c-0.47439,2.23403 -1.29927,4.31705 -2.05805,6.47156c-0.18628,0.52896 -0.1402,1.0974 -0.327,1.62624c-0.09463,0.26791 -0.64731,0.47816 -0.50641,0.73323c0.19122,0.34617 0.86423,0.3445 1.2346,0.58502c1.88637,1.22503 3.50777,2.79494 5.03,4.28305l0.96971,0.73991c0,0 2.20708,1.73229 0,3.46457z"
                                  fill="none"
                                  stroke="#191e2e"
                                  stroke-width="7"
                                ></path>
                              </g>
                            </g>
                          </svg>
                          <svg
                            class="legr"
                            version="1.1"
                            xmlns="http://www.w3.org/2000/svg"
                            width="41.02537"
                            height="64.85502"
                            viewBox="0,0,41.02537,64.85502"
                          >
                            <g transform="translate(-241.54137,-218.44347)">
                              <g stroke-miterlimit="10">
                                <path
                                  d="M279.06674,279.42662c-2.27967,1.98991 -6.08116,0.58804 -6.08116,0.58804l-2.47264,-0.92915c-2.58799,-1.18826 -5.31176,-2.08831 -7.99917,-3.18902c-1.67622,-0.68654 -3.82471,-1.16116 -4.93147,-2.13229c-1.00468,-0.88156 -0.69132,-2.00318 -0.92827,-3.00935c-0.65501,-2.78142 0.12275,-5.56236 -0.287,-8.37565c-0.2181,-4.51941 -0.17458,-9.16283 -1.60696,-13.68334c-0.78143,-2.46614 -2.50162,-4.88125 -3.30086,-7.34796c-1.14452,-3.53236 -1.40387,-7.12078 -2.48433,-10.66266c-0.88858,-2.91287 -2.63779,-5.85389 -3.93351,-8.74177c0,0 -1.07608,-2.39835 3.22395,-2.81415c4.30003,-0.41581 2.41605,1.98254 2.41605,1.98254c1.34779,3.00392 3.13072,6.05282 4.06444,9.0839c1.09065,3.54049 1.33011,7.13302 2.48433,10.66266c0.81245,2.48448 2.5308,4.917 3.31813,7.40431c1.48619,4.69506 1.48366,9.52281 1.71137,14.21503c0.32776,2.25028 0.10631,4.39942 0.00736,6.60975c-0.02429,0.54266 0.28888,1.09302 0.26382,1.63563c-0.01269,0.27488 -0.68173,0.55435 -0.37558,0.78529c0.41549,0.31342 1.34191,0.22213 1.95781,0.40826c3.13684,0.94799 6.06014,2.26892 8.81088,3.52298l1.66093,0.59519c0,0 6.76155,1.40187 4.48187,3.39177z"
                                  fill="none"
                                  stroke="#000000"
                                  stroke-width="7"
                                ></path>
                                <path d="" fill="#ffffff" stroke="none" stroke-width="0.5"></path>
                                <path
                                  d=""
                                  fill-opacity="0.26667"
                                  fill="#97affd"
                                  stroke-opacity="0.48627"
                                  stroke="#ffffff"
                                  stroke-width="0"
                                ></path>
                              </g>
                            </g>
                          </svg>
                          <div class="bod">
                            <svg
                              version="1.1"
                              xmlns="http://www.w3.org/2000/svg"
                              width="144.10576"
                              height="144.91623"
                              viewBox="0,0,144.10576,144.91623"
                            >
                              <g transform="translate(-164.41679,-112.94712)">
                                <g stroke-miterlimit="10">
                                  <path
                                    d="M166.9168,184.02633c0,-36.49454 35.0206,-66.07921 72.05288,-66.07921c37.03228,0 67.05288,29.58467 67.05288,66.07921c0,6.94489 -1.08716,13.63956 -3.10292,19.92772c-2.71464,8.46831 -7.1134,16.19939 -12.809,22.81158c-2.31017,2.68194 -7.54471,12.91599 -7.54471,12.91599c0,0 -5.46714,-1.18309 -8.44434,0.6266c-3.86867,2.35159 -10.95356,10.86714 -10.95356,10.86714c0,0 -6.96906,-3.20396 -9.87477,-2.58085c-2.64748,0.56773 -6.72538,5.77072 -6.72538,5.77072c0,0 -5.5023,-4.25969 -7.5982,-4.25969c-3.08622,0 -9.09924,3.48259 -9.09924,3.48259c0,0 -6.0782,-5.11244 -9.00348,-5.91884c-4.26461,-1.17561 -12.23343,0.75049 -12.23343,0.75049c0,0 -5.18164,-8.26065 -7.60688,-9.90388c-3.50443,-2.37445 -8.8271,-3.95414 -8.8271,-3.95414c0,0 -5.33472,-8.81718 -7.27019,-11.40895c-4.81099,-6.44239 -13.46422,-9.83437 -15.65729,-17.76175c-1.53558,-5.55073 -2.35527,-21.36472 -2.35527,-21.36472z"
                                    fill="#191e2e"
                                    stroke="#000000"
                                    stroke-width="5"
                                    stroke-linecap="butt"
                                  ></path>
                                  <path
                                    d="M167.94713,180c0,-37.03228 35.0206,-67.05288 72.05288,-67.05288c37.03228,0 67.05288,30.0206 67.05288,67.05288c0,7.04722 -1.08716,13.84053 -3.10292,20.22135c-2.71464,8.59309 -7.1134,16.43809 -12.809,23.14771c-2.31017,2.72146 -7.54471,13.1063 -7.54471,13.1063c0,0 -5.46714,-1.20052 -8.44434,0.63584c-3.86867,2.38624 -10.95356,11.02726 -10.95356,11.02726c0,0 -6.96906,-3.25117 -9.87477,-2.61888c-2.64748,0.5761 -6.72538,5.85575 -6.72538,5.85575c0,0 -5.5023,-4.32246 -7.5982,-4.32246c-3.08622,0 -9.09924,3.5339 -9.09924,3.5339c0,0 -6.0782,-5.18777 -9.00348,-6.00605c-4.26461,-1.19293 -12.23343,0.76155 -12.23343,0.76155c0,0 -5.18164,-8.38236 -7.60688,-10.04981c-3.50443,-2.40943 -8.8271,-4.0124 -8.8271,-4.0124c0,0 -5.33472,-8.9471 -7.27019,-11.57706c-4.81099,-6.53732 -13.46422,-9.97928 -15.65729,-18.02347c-1.53558,-5.63252 -2.35527,-21.67953 -2.35527,-21.67953z"
                                    fill="#191e2e"
                                    stroke="none"
                                    stroke-width="0"
                                    stroke-linecap="butt"
                                  ></path>
                                  <path
                                    d=""
                                    fill="#ffffff"
                                    stroke="none"
                                    stroke-width="0.5"
                                    stroke-linecap="butt"
                                  ></path>
                                  <path
                                    d=""
                                    fill-opacity="0.26667"
                                    fill="#97affd"
                                    stroke-opacity="0.48627"
                                    stroke="#ffffff"
                                    stroke-width="0"
                                    stroke-linecap="butt"
                                  ></path>
                                  <path
                                    d="M216.22445,188.06994c0,0 1.02834,11.73245 -3.62335,21.11235c-4.65169,9.3799 -13.06183,10.03776 -13.06183,10.03776c0,0 7.0703,-3.03121 10.89231,-10.7381c4.34839,-8.76831 5.79288,-20.41201 5.79288,-20.41201z"
                                    fill="none"
                                    stroke="#2f3a50"
                                    stroke-width="3"
                                    stroke-linecap="round"
                                  ></path>
                                </g>
                              </g>
                            </svg>
                            <svg
                              class="head"
                              version="1.1"
                              xmlns="http://www.w3.org/2000/svg"
                              width="115.68559"
                              height="88.29441"
                              viewBox="0,0,115.68559,88.29441"
                            >
                              <g transform="translate(-191.87889,-75.62023)">
                                <g stroke-miterlimit="10">
                                  <path
                                    d=""
                                    fill="#ffffff"
                                    stroke="none"
                                    stroke-width="0.5"
                                    stroke-linecap="butt"
                                  ></path>
                                  <path
                                    d="M195.12889,128.77752c0,-26.96048 21.33334,-48.81626 47.64934,-48.81626c26.316,0 47.64935,21.85578 47.64935,48.81626c0,0.60102 -9.22352,20.49284 -9.22352,20.49284l-7.75885,0.35623l-7.59417,6.15039l-8.64295,-1.74822l-11.70703,6.06119l-6.38599,-4.79382l-6.45999,2.36133l-7.01451,-7.38888l-8.11916,1.29382l-6.19237,-6.07265l-7.6263,-1.37795l-4.19835,-7.87062l-4.24236,-4.16907c0,0 -0.13314,-2.0999 -0.13314,-3.29458z"
                                    fill="none"
                                    stroke="#2f3a50"
                                    stroke-width="6"
                                    stroke-linecap="butt"
                                  ></path>
                                  <path
                                    d="M195.31785,124.43649c0,-26.96048 21.33334,-48.81626 47.64934,-48.81626c26.316,0 47.64935,21.85578 47.64935,48.81626c0,1.03481 -0.08666,2.8866 -0.08666,2.8866c0,0 16.8538,15.99287 16.21847,17.23929c-0.66726,1.30905 -23.05667,-4.14265 -23.05667,-4.14265l-2.29866,4.5096l-7.75885,0.35623l-7.59417,6.15039l-8.64295,-1.74822l-11.70703,6.06119l-6.38599,-4.79382l-6.45999,2.36133l-7.01451,-7.38888l-8.11916,1.29382l-6.19237,-6.07265l-7.6263,-1.37795l-4.19835,-7.87062l-4.24236,-4.16907c0,0 -0.13314,-2.0999 -0.13314,-3.29458z"
                                    fill="#191e2e"
                                    stroke-opacity="0.48627"
                                    stroke="#ffffff"
                                    stroke-width="0"
                                    stroke-linecap="butt"
                                  ></path>
                                  <path
                                    d="M271.10348,122.46768l10.06374,-3.28166l24.06547,24.28424"
                                    fill="none"
                                    stroke="#2f3a50"
                                    stroke-width="6"
                                    stroke-linecap="round"
                                  ></path>
                                  <path
                                    d="M306.56448,144.85764l-41.62024,-8.16845l2.44004,-7.87698"
                                    fill="none"
                                    stroke="#000000"
                                    stroke-width="3.5"
                                    stroke-linecap="round"
                                  ></path>
                                  <path
                                    d="M276.02738,115.72434c-0.66448,-4.64715 2.56411,-8.95308 7.21127,-9.61756c4.64715,-0.66448 8.95309,2.56411 9.61757,7.21126c0.46467,3.24972 -1.94776,8.02206 -5.96624,9.09336c-2.11289,-1.73012 -5.08673,-5.03426 -5.08673,-5.03426c0,0 -4.12095,1.16329 -4.60481,1.54229c-0.16433,-0.04891 -0.62732,-0.38126 -0.72803,-0.61269c-0.30602,-0.70328 -0.36302,-2.02286 -0.44303,-2.58239z"
                                    fill="#ffffff"
                                    stroke="none"
                                    stroke-width="0.5"
                                    stroke-linecap="butt"
                                  ></path>
                                  <path
                                    d="M242.49281,125.6424c0,-4.69442 3.80558,-8.5 8.5,-8.5c4.69442,0 8.5,3.80558 8.5,8.5c0,4.69442 -3.80558,8.5 -8.5,8.5c-4.69442,0 -8.5,-3.80558 -8.5,-8.5z"
                                    fill="#ffffff"
                                    stroke="none"
                                    stroke-width="0.5"
                                    stroke-linecap="butt"
                                  ></path>
                                  <path
                                    d=""
                                    fill-opacity="0.26667"
                                    fill="#97affd"
                                    stroke-opacity="0.48627"
                                    stroke="#ffffff"
                                    stroke-width="0"
                                    stroke-linecap="butt"
                                  ></path>
                                </g>
                              </g>
                            </svg>
                          </div>
                          <svg
                            id="gnd"
                            version="1.1"
                            xmlns="http://www.w3.org/2000/svg"
                            width="475"
                            height="530"
                            viewBox="0,0,163.40011,85.20095"
                          >
                            <g transform="translate(-176.25,-207.64957)">
                              <g
                                stroke="#000000"
                                stroke-width="2.5"
                                stroke-linecap="round"
                                stroke-miterlimit="10"
                              >
                                <path
                                  d="M295.5,273.1829c0,0 -57.38915,6.69521 -76.94095,-9.01465c-13.65063,-10.50609 15.70098,-20.69467 -2.5451,-19.94465c-30.31027,2.05753 -38.51396,-26.84135 -38.51396,-26.84135c0,0 6.50084,13.30023 18.93224,19.17888c9.53286,4.50796 26.23632,-1.02541 32.09529,4.95137c3.62417,3.69704 2.8012,6.33005 0.66517,8.49452c-3.79415,3.84467 -11.7312,6.21103 -6.24682,10.43645c22.01082,16.95812 72.55412,12.73944 72.55412,12.73944z"
                                  fill="#000000"
                                ></path>
                                <path
                                  d="M338.92138,217.76285c0,0 -17.49626,12.55408 -45.36424,10.00353c-8.39872,-0.76867 -17.29557,-6.23066 -17.29557,-6.23066c0,0 3.06461,-2.23972 15.41857,0.72484c26.30467,6.31228 47.24124,-4.49771 47.24124,-4.49771z"
                                  fill="#000000"
                                ></path>
                                <path
                                  d="M209.14443,223.00182l1.34223,15.4356l-10.0667,-15.4356"
                                  fill="none"
                                ></path>
                                <path
                                  d="M198.20391,230.41806l12.95386,7.34824l6.71113,-12.08004"
                                  fill="none"
                                ></path>
                                <path d="M211.19621,238.53825l8.5262,-6.09014" fill="none"></path>
                                <path
                                  d="M317.57068,215.80173l5.27812,6.49615l0.40601,-13.39831"
                                  fill="none"
                                ></path>
                                <path d="M323.66082,222.70389l6.09014,-9.33822" fill="none"></path>
                              </g>
                            </g>
                          </svg>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade {% if tab == 'contact' %}show active{% endif %}" id="contact" role="tabpanel">
                <h2>Contact Us</h2>
                <p>For queries, bug reports, or feedback, please email us at <a href="mailto:vasisthakv@gmail.com">vasisthakv@gmail.com</a>.</p>
                <p style="text-align: center; font-style: italic; color: var(--primary-green); margin-top: 20px;">Accurate • Transparent • Built for India 🌾</p>
            </div>
        </div>
        <footer class="footer text-center">
            <div class="container">
                <p>&copy; 2025 AgriBuddy. All rights reserved.</p>
            </div>
        </footer>
    </div>
    <!-- Camera Preview Modal -->
    <div class="camera-preview" id="camera-preview">
        <video id="video" autoplay playsinline></video>
        <button class="btn btn-primary mt-2" onclick="captureImage()">Capture</button>
        <button class="btn btn-secondary mt-2" onclick="closeCamera()">Cancel</button>
    </div>
    <script type="text/javascript">
        document.addEventListener("DOMContentLoaded", function() {
            if (sessionStorage.getItem('agreed') === 'true') {
                document.getElementById('terms').style.display = 'none';
                document.getElementById('content').style.display = 'flex';
            }
        });
        function loadApp() {
            if (document.getElementById('agree').checked) {
                sessionStorage.setItem('agreed', 'true');
                document.getElementById('terms').style.display = 'none';
                document.getElementById('content').style.display = 'flex';
                showGeneralLoading();
            } else {
                alert('Please agree to use AgriBuddy for crop guidance.');
            }
        }
        function showGeneralLoading() {
            const generalLoading = document.createElement('div');
            generalLoading.className = 'loading';
            generalLoading.innerText = 'Connecting Farmers with AI';
            document.body.appendChild(generalLoading);
            setTimeout(() => generalLoading.remove(), 3000);
        }
        function submitFormWithLoading(tabId) {
            const loadingDiv = document.getElementById(`${tabId}-loading`);
            if (loadingDiv) {
                loadingDiv.style.display = 'block';
            }
            document.getElementById(`${tabId}-form`).submit();
        }
        function switchTab(tabId) {
            const link = document.querySelector(`a[href*="${tabId}"]`);
            if (link) link.click();
        }
        function scrollToFeatures() {
            document.getElementById('features').scrollIntoView({ behavior: 'smooth' });
        }
        google.charts.load('current', { packages: ['geochart', 'corechart'] });
        google.charts.setOnLoadCallback(drawMap);
        function drawMap() {
            var data = google.visualization.arrayToDataTable([
                ['State', 'Value'],
            ]);
            var options = {
                resolution: 'provinces',
                region: 'IN',
                backgroundColor: 'transparent',
                datalessRegionColor: '#a5d6a7',
                colorAxis: { colors: ['#4CAF50'] },
                tooltip: { trigger: 'focus' },
                legend: 'none'
            };
            var chart = new google.visualization.GeoChart(document.getElementById('india-map'));
            google.visualization.events.addListener(chart, 'regionClick', function(eventData) {
                var regionCode = eventData.region;
                const stateNameMap = {
                    'IN-AP': 'Andhra Pradesh', 'IN-AR': 'Arunachal Pradesh', 'IN-AS': 'Assam',
                    'IN-BR': 'Bihar', 'IN-CT': 'Chhattisgarh', 'IN-GA': 'Goa', 'IN-GJ': 'Gujarat',
                    'IN-HR': 'Haryana', 'IN-HP': 'Himachal Pradesh', 'IN-JH': 'Jharkhand',
                    'IN-KA': 'Karnataka', 'IN-KL': 'Kerala', 'IN-MP': 'Madhya Pradesh',
                    'IN-MH': 'Maharashtra', 'IN-MN': 'Manipur', 'IN-ML': 'Meghalaya',
                    'IN-MZ': 'Mizoram', 'IN-NL': 'Nagaland', 'IN-OR': 'Odisha', 'IN-PB': 'Punjab',
                    'IN-RJ': 'Rajasthan', 'IN-SK': 'Sikkim', 'IN-TN': 'Tamil Nadu', 'IN-TS': 'Telangana',
                    'IN-TR': 'Tripura', 'IN-UT': 'Uttarakhand', 'IN-UP': 'Utar Pradesh',
                    'IN-WB': 'West Bengal', 'IN-AN': 'Andaman and Nicobar Islands', 'IN-CH': 'Chandigarh',
                    'IN-DN': 'Dadra and Nagar Haveli and Daman and Diu', 'IN-DL': 'Delhi',
                    'IN-JK': 'Jammu and Kashmir', 'IN-LA': 'Ladakh', 'IN-LD': 'Lakshadweep',
                    'IN-PY': 'Puducherry'
                };
                const stateName = stateNameMap[regionCode];
                if (stateName) {
                    document.getElementById('state-dropdown').value = stateName;
                    var highlightData = google.visualization.arrayToDataTable([
                        ['State', 'Value'],
                        [regionCode, 1]
                    ]);
                    chart.draw(highlightData, options);
                }
            });
            chart.draw(data, options);
        }
        // Toggle crop details on click
        document.addEventListener("DOMContentLoaded", function() {
            const cropItems = document.getElementsByClassName('crop-item');
            for (let item of cropItems) {
                item.addEventListener('click', function() {
                    const detailsId = 'details-' + Array.from(cropItems).indexOf(item);
                    const details = document.getElementById(detailsId);
                    if (details.style.display === 'block') {
                        details.style.display = 'none';
                    } else {
                        details.style.display = 'block';
                    }
                });
            }
        });
        // Camera access
        let currentInputId = null;
        let stream = null;
        async function accessCamera(inputId) {
            currentInputId = inputId;
            const preview = document.getElementById('camera-preview');
            preview.style.display = 'block';
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: true });
                const video = document.getElementById('video');
                video.srcObject = stream;
            } catch (err) {
                console.error("Error accessing camera: ", err);
                alert("Could not access camera. Please check permissions.");
                closeCamera();
            }
        }
        function captureImage() {
            const video = document.getElementById('video');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            canvas.toBlob(blob => {
                const file = new File([blob], 'captured_image.jpg', { type: 'image/jpeg' });
                const dt = new DataTransfer();
                dt.items.add(file);
                const input = document.getElementById(currentInputId);
                input.files = dt.files;
                const previewId = currentInputId === 'image' ? 'soil-preview' : 'health-preview';
                const previewImg = document.getElementById(previewId);
                previewImg.src = URL.createObjectURL(blob);
                previewImg.style.display = 'block';
                closeCamera();
            }, 'image/jpeg');
        }
        function closeCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            document.getElementById('camera-preview').style.display = 'none';
        }
        function previewImage(event, previewId) {
            const file = event.target.files[0];
            if (file) {
                const previewImg = document.getElementById(previewId);
                previewImg.src = URL.createObjectURL(file);
                previewImg.style.display = 'block';
            }
        }
        // Rainfall Stats Toggle and Chart
        document.addEventListener('DOMContentLoaded', function() {
            const showStatsBtn = document.getElementById('show-stats-btn');
            const statsDiv = document.getElementById('rainfall-stats');
            const detailsBtn = document.getElementById('details-btn');
            const detailsDiv = document.getElementById('anomaly-details');
            if (showStatsBtn && statsDiv) {
                showStatsBtn.addEventListener('click', function() {
                    if (statsDiv.style.display === 'none' || statsDiv.style.display === '') {
                        statsDiv.style.display = 'block';
                        drawRainfallChart();
                        // Show details button only if anomaly exists
                        if (window.hasAnomaly && detailsBtn) {
                            detailsBtn.style.display = 'inline-block';
                        }
                    } else {
                        statsDiv.style.display = 'none';
                        // Hide details button when stats are hidden
                        if (detailsBtn) {
                            detailsBtn.style.display = 'none';
                        }
                    }
                });
            }
            if (detailsBtn && detailsDiv) {
                detailsBtn.addEventListener('click', function() {
                    if (detailsDiv.style.display === 'none' || detailsDiv.style.display === '') {
                        detailsDiv.style.display = 'block';
                    } else {
                        detailsDiv.style.display = 'none';
                    }
                });
            }
            function drawRainfallChart() {
                const historicalAvg = parseFloat('{{ historical_avg|default('0') }}') || 0;
                const predicted = parseFloat('{{ predicted_rainfall|default('0') }}') || 0;
                const anomaly = historicalAvg > 0 ? ((predicted - historicalAvg) / historicalAvg * 100).toFixed(1) : 0;
                const data = google.visualization.arrayToDataTable([
                    ['Category', 'Rainfall (mm)', {role: 'tooltip'}],
                    ['Historical', historicalAvg, `Historical Average: ${historicalAvg.toFixed(1)} mm`],
                    ['Predicted', predicted, `Predicted Rainfall: ${predicted.toFixed(1)} mm (${anomaly > 0 ? '+' : ''}${anomaly}% deviation from average)`]
                ]);
                const options = {
                    chartArea: { width: '70%', height: '70%' },
                    colors: ['#4CAF50', predicted > historicalAvg ? '#FF9800' : '#F44336'],
                    hAxis: {
                        title: 'Rainfall Category',
                        titleTextStyle: { fontSize: 20, bold: true },
                        textStyle: { fontSize: 16, bold: true }
                    },
                    vAxis: {
                        title: 'Rainfall (mm)',
                        titleTextStyle: { fontSize: 20, bold: true },
                        textStyle: { fontSize: 16, bold: true }
                    },
                    legend: { position: 'top' },
                    bar: { groupWidth: '40%' }
                };
                const chart = new google.visualization.ColumnChart(document.getElementById('rainfall-chart'));
                chart.draw(data, options);
            }
        });
        // Recommendation Stats Toggle and Chart
        document.addEventListener('DOMContentLoaded', function() {
            const showRecStatsBtn = document.getElementById('show-rec-stats-btn');
            const recStatsDiv = document.getElementById('rec-stats');
            if (showRecStatsBtn && recStatsDiv) {
                showRecStatsBtn.addEventListener('click', function() {
                    if (recStatsDiv.style.display === 'none' || recStatsDiv.style.display === '') {
                        recStatsDiv.style.display = 'block';
                        // Yield Comparison Chart
                        {% if rec_yield_data %}
                        const recYieldData = {{ rec_yield_data | tojson }};
                        const validYieldData = recYieldData.filter(item => item.state !== null && !isNaN(parseFloat(item.state)));
                        validYieldData.sort((a, b) => (parseFloat(a.state) || 0) - (parseFloat(b.state) || 0));
                        const nullYieldData = recYieldData.filter(item => item.state === null || isNaN(parseFloat(item.state)));
                        const sortedYieldData = [...validYieldData, ...nullYieldData];
                        // Extract sorted labels
                        const labels = sortedYieldData.map(item => item.crop);
                        const nValid = validYieldData.length;
                        // Remap state data to even steps: [1, 2, ..., nValid] for valid; 0 for nulls
                        const steppedStateData = sortedYieldData.map((item, index) => {
                            if (index < nValid) return index + 1; // Even steps 1 to nValid
                            return 0; // Nulls at bottom
                        });
                        // For national: compute ranks based on sorted national yields
                        const validNatData = recYieldData.filter(item => item.national !== null && !isNaN(parseFloat(item.national)));
                        validNatData.sort((a, b) => (parseFloat(a.national) || 0) - (parseFloat(b.national) || 0));
                        const nValidNat = validNatData.length;
                        const natRankMap = {};
                        validNatData.forEach((item, index) => {
                            natRankMap[item.crop] = index + 1;
                        });
                        const steppedNationalData = labels.map(crop => natRankMap[crop] || 0);
                        const chartMax = Math.max(nValid, nValidNat, 1);
                        // Store actuals for callbacks
                        const nationalDataRaw = labels.map(cropName => {
                            const matchingItem = recYieldData.find(item => item.crop === cropName);
                            return parseFloat(matchingItem ? matchingItem.national : 0) || 0;
                        });
                        window.yieldActuals = { state: sortedYieldData.map(item => parseFloat(item.state) || 0), national: nationalDataRaw };
                        const yieldCanvas = document.getElementById('yield-chart');
                        if (yieldCanvas) {
                            const yieldCtx = yieldCanvas.getContext('2d');
                            if (window.yieldChart) window.yieldChart.destroy();
                            window.yieldChart = new Chart(yieldCtx, {
                                type: 'bar',
                                data: {
                                    labels: labels,
                                    datasets: [
                                        {
                                            label: '{{ selected_state.title() if selected_state else "State" }} Average (tons/ha)',
                                            data: steppedStateData,
                                            backgroundColor: 'rgba(76, 175, 80, 0.6)',
                                            borderColor: 'rgba(76, 175, 80, 1)',
                                            borderWidth: 1
                                        },
                                        {
                                            label: 'National Average (tons/ha)',
                                            data: steppedNationalData,
                                            backgroundColor: 'rgba(255, 152, 0, 0.6)',
                                            borderColor: 'rgba(255, 152, 0, 1)',
                                            borderWidth: 1
                                        }
                                    ]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    interaction: {
                                        intersect: false,
                                        mode: 'index'
                                    },
                                    scales: {
                                        y: {
                                            min: 0,
                                            max: chartMax,
                                            ticks: {
                                                stepSize: 1,
                                                callback: function(value, index) {
                                                    if (value === 0) return '0';
                                                    if (value <= nValid && index > 0) {
                                                        // Map step back to actual sorted state yield
                                                        return window.yieldActuals.state[index - 1].toFixed(1);
                                                    }
                                                    return '';
                                                }
                                            },
                                            title: {
                                                display: true,
                                                text: 'Yield (tons/ha)'
                                            }
                                        },
                                        x: {
                                            title: {
                                                display: true,
                                                text: 'Crops (Sorted by State Yield)'
                                            }
                                        }
                                    },
                                    plugins: {
                                        title: {
                                            display: true,
                                            text: 'Crop Yield Comparison (Even Visual Steps for Both State & National)'
                                        },
                                        tooltip: {
                                            callbacks: {
                                                title: function(context) {
                                                    return context[0].label; // Crop name
                                                },
                                                label: function(context) {
                                                    const actuals = window.yieldActuals;
                                                    const idx = context.dataIndex;
                                                    if (context.datasetIndex === 0) {
                                                        return `{{ selected_state.title() if selected_state else "State" }}: ${actuals.state[idx].toFixed(1)} tons/ha`;
                                                    } else {
                                                        return `National: ${actuals.national[idx].toFixed(1)} tons/ha`;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            });
                        }
                        {% endif %}
                        // Seasonal Success Chart
                        {% if seasonal_success_data %}
                        const seasonalData = {{ seasonal_success_data | tojson }};
                        const seasonalLabels = seasonalData.map(item => item.season);
                        const successData = seasonalData.map(item => item.success);
                        const seasonalCanvas = document.getElementById('seasonal-chart');
                        if (seasonalCanvas) {
                            const seasonalCtx = seasonalCanvas.getContext('2d');
                            if (window.seasonalChart) window.seasonalChart.destroy();
                            window.seasonalChart = new Chart(seasonalCtx, {
                                type: 'bar',
                                data: {
                                    labels: seasonalLabels,
                                    datasets: [{
                                        label: 'Average Yield (tons/ha)',
                                        data: successData,
                                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                                        borderColor: 'rgba(54, 162, 235, 1)',
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    scales: { y: { beginAtZero: true } },
                                    plugins: {
                                        title: { display: true, text: 'Seasonal Success (Average State Yield)' }
                                    }
                                }
                            });
                        }
                        {% endif %}
                        // Regional Popularity Pie Chart
                        {% if regional_popularity_data %}
                        const popularityData = {{ regional_popularity_data | tojson }};
                        const popLabels = popularityData.map(item => item.crop);
                        const popData = popularityData.map(item => item.yield);
                        const popularityCanvas = document.getElementById('popularity-chart');
                        if (popularityCanvas) {
                            const popCtx = popularityCanvas.getContext('2d');
                            if (window.popularityChart) window.popularityChart.destroy();
                            window.popularityChart = new Chart(popCtx, {
                                type: 'pie',
                                data: {
                                    labels: popLabels,
                                    datasets: [{
                                        data: popData,
                                        backgroundColor: [
                                            'rgba(255, 99, 132, 0.6)',
                                            'rgba(54, 162, 235, 0.6)',
                                            'rgba(255, 205, 86, 0.6)',
                                            'rgba(75, 192, 192, 0.6)',
                                            'rgba(153, 102, 255, 0.6)',
                                            'rgba(255, 159, 64, 0.6)',
                                            'rgba(199, 199, 199, 0.6)'
                                        ],
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        legend: { position: 'top' },
                                        title: { display: true, text: 'Regional Popularity by Yield (Larger slice = Higher Yield)' }
                                    }
                                }
                            });
                        }
                        {% endif %}
                    } else {
                        recStatsDiv.style.display = 'none';
                    }
                });
            }
        });
        // Reveal-on-scroll animations
        document.addEventListener('DOMContentLoaded', function() {
            const observer = new IntersectionObserver((entries, obs) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        obs.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.2, rootMargin: '0px 0px -50px 0px' });

            document.querySelectorAll('.animate-on-scroll').forEach(el => observer.observe(el));
        });
        // Gentle parallax on hero background
        window.addEventListener('scroll', function() {
            const heroSection = document.querySelector('.hero');
            if (!heroSection) return;
            const offset = window.pageYOffset;
            heroSection.style.backgroundPositionY = `${offset * 0.35}px`;
        });
        window.onload = function() {
            if (sessionStorage.getItem('agreed') === 'true') {
                document.getElementById('terms').style.display = 'none';
                document.getElementById('content').style.display = 'flex';
            }
        };
    </script>
</body>
</html>